#!/bin/bash

read -r model_id session_id < <(jq -r '[.model.id // "", .session_id // ""] | @tsv')

# Get session cost if session_id exists
cost_display=""
if [[ -n "$session_id" ]]; then
    # Use command substitution with || to handle failures gracefully
    if cost=$(bun x ccusage session --id "$session_id" --json --jq '.totalCost' 2>/dev/null) \
       && [[ -n "$cost" && "$cost" != "null" ]]; then
        printf -v cost_display " \$%.2f" "$cost" 2>/dev/null || cost_display=""
    fi
fi

case "$model_id" in
    *bedrock*|*anthropic.claude*|*aws*)
        printf "\033[33mBedrock\033[0m%s\n" "$cost_display"
        ;;
    *)
        printf "\033[36mClaude API\033[0m%s\n" "$cost_display"
        ;;
esac
